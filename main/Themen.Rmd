
```{r packages}
library(tidyverse)
```

```{r Daten für Grafiken anpassen}
data <- read.csv("cleandedData.csv")

# Nur deutsche Automarken ohne ausländische Marken, die deutschen Herstellern gehören (z.B. MINI, Skoda, etc.)
deutscheMarken <- c("Mercedes-Benz", "Opel", "Porsche", "smart", "ALPINA", "Audi", "BMW", "VW", "VW Nutzfahrzeuge")

# Spalte für deutsch/ausländisch erstellen
data <- data %>% 
  mutate(deutscher.Hersteller = Marke %in% deutscheMarken,
         deutscher.Hersteller = ifelse(deutscher.Hersteller, "deutsch", "ausländisch"))

# CO2-Ausstoß Spalte zu numeric machen
data <- data %>% 
  mutate(CO2.Wert..NEFZ. = gsub(" g/km", "", CO2.Wert..NEFZ.),
         CO2.Wert..NEFZ. = as.numeric(CO2.Wert..NEFZ.)) %>% 
  rename(CO2.Ausstoß_g.pro.km = CO2.Wert..NEFZ.)

# Baureihenstart zu Date umformatieren
data <- data %>% 
  mutate(Baureihenstart = as.Date(paste("01/", Baureihenstart, sep = ""), "%d/%m/%y"))

# Fahrzeugklasse Beispiel entfernen
data <- data %>% 
  mutate(Fahrzeugklasse = gsub(" +\\(.*\\)", "", Fahrzeugklasse))

# Motorarten zusammenfassen (z.B. alle Hybridarten zu Hybrid)
data <- data %>% 
  mutate(Motorart = ifelse(grepl("Hybrid", Motorart), "Hybrid", Motorart),
         Motorart = ifelse(Motorart %in% c("Diesel", "Otto"), "Verbrenner", ifelse(Motorart %in% "Hybrid", "Hybrid", "Elektro/Gas")))
  

# Hubraum..Verbrennungsmotor. zu numeric machen
data <- data %>% 
  mutate(Hubraum..Verbrennungsmotor. = gsub(" ccm", "", Hubraum..Verbrennungsmotor.),
         Hubraum..Verbrennungsmotor. = as.numeric(Hubraum..Verbrennungsmotor.)) %>% 
  rename(Hubraumgröße = Hubraum..Verbrennungsmotor.)

# Verbrauch.Gesamt..NEFZ. zu numeric machen
data <- data %>% 
  mutate(Verbrauch.Gesamt..NEFZ. = gsub(" l/100 km| kWh/100 km| kg/100 km", "", Verbrauch.Gesamt..NEFZ.),
         Verbrauch.Gesamt..NEFZ. = gsub(",", ".", Verbrauch.Gesamt..NEFZ.),
         Verbrauch.Gesamt..NEFZ. = as.numeric(Verbrauch.Gesamt..NEFZ.)) %>% 
  rename(Verbrauch.gesamt.in.l.kg.kWh_100Km = Verbrauch.Gesamt..NEFZ.)

# Leergewicht..EU. zu. numeric machen
data <- data %>%
  mutate(Leergewicht..EU. = gsub(" kg$", "", Leergewicht..EU.),
         Leergewicht..EU. = as.numeric(Leergewicht..EU.)) %>% 
  rename(Leergewicht..EU.in.kg = Leergewicht..EU.)
```

Thema 1

CO2-Effizienzklasse: Gibt die CO2-Effizienzklasse des Autos an.
Anschauen mit: Modellstart,  Leistung, Fahrzeugklassen
+
CO2.Wert..NEFZ.: Gibt den CO2-Ausstoß des Autos in g/km an.
```{r}

```

Thema 2

Grundpreis: Gibt den Preis des Autos in Euro an. (gibt ne seperate Note/ Punkte für den Preis/Kosten)
Anschauen mit: Baureihenstart 
Laufende Kosten: Baureihenstart (Weltfinanzkrise 2007/8) (Eurokrise - deutsche/ausländische vergleichen wegen Auswirkungen)
```{r}

```

Thema 3

Motorart: Gibt die Motorart des Autos an. (Vllt. in allgeimeine Werte umwandeln, z.B. Verbrenner, Elektro, etc.)
Anschauen mit: Modellstart (Entwicklung zu Elektroautos erkennbar?)
```{r}
# Häufigkeit der einzelnen Motorarten
ggplot(data, aes(x = Motorart)) + 
  geom_bar() +
  labs(
    title = "Häufigkeit der einzelnen Motorarten",
    y = "Anzahl"
  )

# Häufigkeiten der einzelnen Motorarten als Vergleich zwischen deutschen und ausländischen Herstellern
ggplot(data, aes(x = Motorart, fill = deutscher.Hersteller)) +
  geom_bar(position = "dodge") +
  labs(
    title = "Vergleich zwischen deutschen und ausländischen Herstellern",
    y = "Anzahl",
    fill = "Hersteller"
  )

# Relative Häufigkeiten der einzelnen Motorarten als Vergleich zwischen deutschen und ausländischen Herstellern
data %>% 
  group_by(Motorart) %>%
  mutate(Anzahl.Motorart = n()) %>% 
  group_by(Motorart, deutscher.Hersteller) %>%
  mutate(Anzahl.Hersteller.Motorart = n()) %>% 
  mutate(relativ.Motorart = Anzahl.Hersteller.Motorart / Anzahl.Motorart) %>% 
  ggplot(aes(x = Motorart, y = relativ.Motorart, fill = deutscher.Hersteller)) +
  geom_col(position = "dodge") +
  labs(
    title = "relativer Vergleich zwischen deutschen und ausländischen Herstellern",
    y = "relative Häufigkeit",
    fill = "Hersteller"
  )

# Häufigkeit der Motorarten nach Baureihenstart (zeitliche Entwicklung)
data %>% 
  #mutate(
  #  Motorart = ifelse(Motorart %in% c("Diesel", "Otto"), "Verbrenner", ifelse(Motorart %in% "Hybrid", "Hybrid", "Elektro/Gas"))) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Motorart) %>% 
  count() %>% 
  ggplot(aes(x = Baureihenstart, y = n, color = Motorart)) +
  geom_line() +
  labs(y = "Anzahl")

# Relative Häufigkeit der Motorarten nach Baureihenstart (zeitliche Entwicklung)
data %>% 
  #mutate(
  #  Motorart = ifelse(Motorart %in% c("Diesel", "Otto"), "Verbrenner", ifelse(Motorart %in% "Hybrid", "Hybrid", "Elektro/Gas"))) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>%
  mutate(Anzahl.Jahr = n()) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Motorart) %>%
  mutate(Anzahl.Jahr.Motorart = n()) %>% 
  mutate(relativ.Motorart = Anzahl.Jahr.Motorart / Anzahl.Jahr) %>% 
  ggplot(aes(x = Baureihenstart, y = relativ.Motorart, color = Motorart)) +
  geom_line() +
  labs(
    title = "Relative Häufigkeit der Motorarten nach Baureihenstart",
    y = "relative Häufigkeit"
  )

# Vergleich der Entwicklung der Motorarten zwischen deutschen und ausländischen Herstellern
data %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), deutscher.Hersteller) %>%
  mutate(Anzahl.Jahr = n()) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), deutscher.Hersteller, Motorart) %>%
  mutate(Anzahl.Jahr.Motorart = n()) %>% 
  mutate(relativ.Motorart = Anzahl.Jahr.Motorart / Anzahl.Jahr) %>% 
  ggplot(aes(x = Baureihenstart, y = relativ.Motorart, color = Motorart)) +
  geom_line() +
  facet_wrap(~deutscher.Hersteller) +
  labs(
    title = "Relative Häufigkeit der Motorarten nach Baureihenstart",
    y = "relative Häufigkeit"
  )
```

Thema 4

Leistung.maximal.in.PS..Systemleistung.: Gibt die maximale PS des Autos an.  # Vllt. in kW angeben, da das die offizielle Angabe ist?
Anschauen mit: Modellstart, CO2-Ausstoß, Motorart, Hubraumgröße, Leistung/Gewicht verhältniss (bei Alex)
```{r}
# Leistung in PS nach Baureihenstart (zeitliche Entwicklung)
data %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>% 
  summarise(Leistung.in.PS = mean(Leistung.maximal.in.PS..Systemleistung.)) %>% 
  ggplot(aes(x = Baureihenstart, y = Leistung.in.PS)) +
  geom_line() +
  labs(
    title = "Leistung in PS nach Baureihenstart",
    y = "PS"
  )

# CO2-Ausstoß nach Leistung in PS
data %>% 
  group_by(Leistung.maximal.in.PS..Systemleistung.) %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  summarise(CO2.Ausstoß = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Leistung.maximal.in.PS..Systemleistung., y = CO2.Ausstoß)) +
  geom_point() +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(
    title = "CO2-Ausstoß nach Leistung in PS",
    x = "PS",
    y = "CO2-Ausstoß in g/km"
  )

# Maximale Leistung nach Motorarten
data %>% 
  #mutate(
  #  Motorart = ifelse(Motorart %in% c("Diesel", "Otto"), "Verbrenner", ifelse(Motorart %in% "Hybrid", "Hybrid", "Elektro/Gas"))) %>% 
  group_by(Motorart) %>% 
  summarise(Leistun.in.PS = max(Leistung.maximal.in.PS..Systemleistung.)) %>% 
  ggplot(aes(x = Motorart, y = Leistun.in.PS)) +
  geom_col() + 
  labs(
    title = "Maximale Leistung in PS nach Motorart",
    y = "PS"
  )

# Maximale Leistung in PS der Motorarten nach Baureihenstart (zeitliche Entwicklung)
data %>% 
  #mutate(
  #  Motorart = ifelse(Motorart %in% c("Diesel", "Otto"), "Verbrenner", ifelse(Motorart %in% "Hybrid", "Hybrid", "Elektro/Gas"))) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Motorart) %>% 
  mutate(Leistung.in.PS = mean(Leistung.maximal.in.PS..Systemleistung.)) %>% 
  ggplot(aes(x = Baureihenstart, y = Leistung.in.PS, color = Motorart)) +
  geom_smooth(se = FALSE) + # Vllt durch geom_point oder geom_line ersetzen?
  labs(
  title = "Leistung in PS der Motorarten nach Baureihenstart",
  y = "PS"
  )

# Leistung in PS nach Hubraumgröße
data %>% 
  drop_na(Hubraumgröße) %>% 
  group_by(Hubraumgröße) %>% 
  summarise(Leistung.in.PS = mean(Leistung.maximal.in.PS..Systemleistung.)) %>% 
  ggplot(aes(x = Hubraumgröße, y = Leistung.in.PS)) + 
  geom_point() +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(
    title = "Leistung in PS nach Hubraumgröße",
    y = "PS"
  )

# CO2-Ausstoß nach Baureihenstart gruppiert nach Leistung in PS für Verbrenner
data %>% 
  filter(Motorart == "Verbrenner") %>% 
  mutate(Leistung.maximal.in.PS..Systemleistung. = cut(Leistung.maximal.in.PS..Systemleistung.,
                                                       breaks = c(0, 120, 180, 300, Inf))) %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Leistung.maximal.in.PS..Systemleistung.) %>% 
  mutate(CO2.Ausstoß = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Baureihenstart, y = CO2.Ausstoß, color = Leistung.maximal.in.PS..Systemleistung.)) +
  geom_line() +
  labs(
    title = "CO2-Ausstoß nach Baureihenstart gruppiert nach Leistung in PS (Verbrennermotor)",
    y = "CO2-Ausstoß in g/km",
    color = "PS"
  ) +
  scale_color_discrete(labels = c("<120", "120-180", "180-300", "300<"))

# Verhältniss von Gewicht zu Leistung nach Baureihenstart gruppiert gruppiert nach Motorart
data %>%
  drop_na(Leergewicht..EU.in.kg) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Motorart) %>% 
  mutate(Verhältnis = Leergewicht..EU.in.kg / Leistung.maximal.in.PS..Systemleistung.) %>% 
  ggplot(aes(x = Baureihenstart, y = Verhältnis, color = Motorart)) + 
  geom_smooth(method = "loess", se = FALSE) + 
  labs(
    title = "Leistungsgewicht abhängig von Motorart",
    y = "Leistungsgewicht in kg/PS",
    color = "Motorart"
  )
```

Thema 5

Hubraum..Verbrennungsmotor. / Hubraum: Gibt die Hubraumgröße des Motors des Autos in ccm an.
Anschauen mit: Modellstart, CO2-Ausstoß, CO2-Effizienzklasse, Treibstoffverbrauch, Leistung (bei Daniel)
```{r}
# Hubraumgröße in ccm nach Baureihenstart (zeitliche Entwicklung)
data %>% 
  drop_na(Hubraumgröße) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>% 
  summarise(Hubraumgröße = mean(Hubraumgröße)) %>% 
  ggplot(aes(x = Baureihenstart, y = Hubraumgröße)) +
  geom_line() +
  labs(
    title = "Hubraumgröße nach Baureihenstart",
    y = "Hubraumgröße in ccm"
  )

# CO2-Ausstoß nach Hubraumgröße in ccm für Verbrenner
data %>% 
  filter(Motorart == "Verbrenner") %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  group_by(Hubraumgröße) %>% 
  summarise(CO2.Ausstoß = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Hubraumgröße, y = CO2.Ausstoß)) + 
  geom_point() +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(
    title = "CO2-Ausstoß nach Hubraumgröße (Verbrenner)",
    x = "Hubraumgröße in ccm",
    y = "CO2-Ausstoß in g/km"
  )

# Treibstoffverbrauch nach Hubraumgröße
data %>% 
  filter(Motorart == "Verbrenner") %>% 
  drop_na(Verbrauch.gesamt.in.l.kg.kWh_100Km) %>% 
  group_by(Hubraumgröße) %>% 
  summarise(Verbrauch.in.l_pro_100km = mean(Verbrauch.gesamt.in.l.kg.kWh_100Km)) %>% 
  ggplot(aes(x = Hubraumgröße, y = Verbrauch.in.l_pro_100km)) +
  geom_point() +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(
    title = "Treibstoffverbrauch nach Hubraumgröße",
    y = "Verbrauch in l/100km"
  )

# CO2-Ausstoß nach Baureihenstart gruppiert nach Hubraumgröße in ccm für Verbrenner
data %>% 
  filter(Motorart == "Verbrenner") %>% 
  mutate(Hubraumgröße = cut(Hubraumgröße, breaks = c(0, 1500, 2000, 3000, Inf))) %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Hubraumgröße) %>% 
  mutate(CO2.Ausstoß = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Baureihenstart, y = CO2.Ausstoß, color = Hubraumgröße)) +
  geom_line() +
  labs(
    title = "CO2-Ausstoß nach Baureihenstart gruppiert nach Hubraumgröße (Verbrennermotor)",
    y = "CO2-Ausstoß in g/km",
    color = "ccm"
  ) +
  scale_color_discrete(labels = c("<1500", "1500-2000", "2000-3000", "3000<"))
```

Thema 6

Länge, Breite, Höhe -> Größe/Volumen: Gibt das Volumen des Autos in mm^3/m^3 an.
Anschauen mit: Modellstart (Autos werden immer größer), Hubraumgröße, CO2-Ausstoß, PS, Treibstoffverbrauch (bei Alex)
+
Leergewicht..EU.: Gibt das Leergewicht des Autos in kg an.
Anschauen mit: Verbrauch, Modellstart, CO2-Effizienzklasse, CO2-Ausstoß
+
Karosserieform
Anschauen mit: Höchstgescwindigkeit und Verbrauch
```{r}

```

Thema 7

CO2.Ausstoß: Gibt den Vergleich zwischen dem CO2-Ausstoß nach Herstellerangabe und dem ADAC Ecotest an.
Anschauen mit: Verhältnis zwischen angaben und realität (Diesel skandal sichtbar ?), Top X Marken oder deutsch ausländisch etc., Fahrzeugklasse
+
Verbrauch: Gibt den Vergleich zwischen dem Verbrauch nach Herstellerangabe und dem ADAC Ecotest an.

```{r}

```

Thema 8

Elektroautos:

Ladezeiten: Gibt die Ladezeiten der Elektroautos bis zu 100% in Minuten für verschiedene Anschlüsse an.
Anschauen mit: Batteriekapazität, Modellstart, Marke
+
Reichweite.WLTP..elektrisch.: Gibt die Reichweite für Elektroautos in km an.
Anschauen mit: Batteriekapazität, Modellstart, Marke (Vergleich mit der Reichweite von Verbrenner (muss berechnet werden))
+
Batteriekapazität..Netto..in.kWh: Gibt die Batteriekapazität der Autos in kWh an. (Hauptsächlich interessant für Elektroautos)
Anschauen mit: Modellstart, Marke
      
```{r}

```

Thema 9

Sicherheitsaspekte: Gibt die Anzahl an eingebauten Sicherheitsfeatures des Autos an. (Muss noch erstellt werden aus allen möglichen Spalten)
Anschauen mit: Modellstart, Marke, enthalten oder gegen Aufpreis 

```{r}

```

Thema 10

Anlass : welcher Mängel aufgetreten ist 
Zusammen mit Baureihenstart und Marke und Anzahl betroffener Fahrzeuge
```{r}

```

Thema 11
```{r}

```

Thema 12
```{r}

```

Thema 13
```{r}

```

Thema 14
```{r}

```

Thema 15
```{r}

```



----------------------------------------------
Variablen 


1.  Marke: Gibt den Hersteller des Autos an.

2.  Modellstart/Baureihenstart: Gibt an, wann das Modell angefangen wurde, produziert zu werden.

3.  CO2-Effizienzklasse: Gibt die CO2-Effizienzklasse des Autos an.

4.  Grundpreis: Gibt den Preis des Autos in Euro an.

5.  Motorart: Gibt die Motorart des Autos an. (Vllt. in allgeimeine Werte umwandeln, z.B. Verbrenner, Elektro, etc.)

6.  Leistung.maximal.in.PS..Systemleistung.: Gibt die maximale PS des Autos an.  # Vllt. in kW angeben, da das die offizielle Angabe ist?

7.  Hubraum..Verbrennungsmotor. / Hubraum: Gibt die Hubraumgröße des Motors des Autos in ccm an.

8.  Länge, Breite, Höhe -> Größe/Volumen: Gibt das Volumen des Autos in mm^3/m^3 an.

9.  Leergewicht..EU.: Gibt das Leergewicht des Autos in kg an.

10. Fahrzeugklasse: Gibt die Klasse des Autos an.

11. Höchstgeschwindigkeit: Gibt die Höchstgeschwindigkeit des Autos in km/h an.

12. Verbrauch.Gesamt..NEFZ.: Gibt den Gesamtverbrauch des Autos in l/100km oder kg/100km oder kWh/100km an.

13. CO2.Wert..NEFZ.: Gibt den CO2-Ausstoß des Autos in g/km an.

14. CO2.Ausstoß: Gibt den Vergleich zwischen dem CO2-Ausstoß nach Herstellerangabe und dem ADAC Ecotest an.

15. Verbrauch: Gibt den Vergleich zwischen dem Verbrauch nach Herstellerangabe und dem ADAC Ecotest an.

16. Ladezeiten: Gibt die Ladezeiten der Elektroautos bis zu 100% in Minuten für verschiedene Anschlüsse an.

17. Reichweite.WLTP..elektrisch.: Gibt die Reichweite für Elektroautos in km an.

18. Batteriekapazität..Netto..in.kWh: Gibt die Batteriekapazität der Autos in kWh an. 

19. Sicherheitsaspekte: Gibt die Anzahl an eingebauten Sicherheitsfeatures des Autos an. (Muss noch erstellt werden aus allen möglichen Spalten)

20. Anlass : welcher Mängel aufgetreten ist 