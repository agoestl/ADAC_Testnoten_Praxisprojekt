
```{r packages}
library(tidyverse)
library(ggplot2)
library(dplyr)
library(stringr)
```

```{r Daten für Grafiken anpassen}
data <- read.csv("cleandedData.csv")

# Nur deutsche Automarken ohne ausländische Marken, die deutschen Herstellern gehören (z.B. MINI, Skoda, etc.)
deutscheMarken <- c("Mercedes-Benz", "Opel", "Porsche", "smart", "ALPINA", "Audi", "BMW", "VW", "VW Nutzfahrzeuge")

# Spalte für deutsch/ausländisch erstellen
data <- data %>% 
  mutate(deutscher.Hersteller = Marke %in% deutscheMarken,
         deutscher.Hersteller = ifelse(deutscher.Hersteller, "deutsch", "ausländisch"))

# CO2-Ausstoß Spalte zu numeric machen
data <- data %>% 
  mutate(CO2.Wert..NEFZ. = gsub(" g/km", "", CO2.Wert..NEFZ.),
         CO2.Wert..NEFZ. = as.numeric(CO2.Wert..NEFZ.)) %>% 
  rename(CO2.Ausstoß_g.pro.km = CO2.Wert..NEFZ.)

# Baureihenstart zu Date umformatieren
data <- data %>% 
  mutate(Baureihenstart = as.Date(paste("01/", Baureihenstart, sep = ""), "%d/%m/%y"))

# Fahrzeugklasse Beispiel entfernen
data <- data %>% 
  mutate(Fahrzeugklasse = gsub(" +\\(.*\\)", "", Fahrzeugklasse))

# Motorarten zusammenfassen (z.B. alle Hybridarten zu Hybrid)
data <- data %>% 
  mutate(Motorart = ifelse(grepl("Hybrid", Motorart), "Hybrid",
                           ifelse(Motorart %in% c("Diesel", "Otto", "Wankel"), "Verbrenner",
                                  ifelse(grepl("Elektro", Motorart), "Elektro",
                                         ifelse(grepl("Gas", Motorart), "Gas", "Andere")))))  

# Hubraum..Verbrennungsmotor. zu numeric machen
data <- data %>% 
  mutate(Hubraum..Verbrennungsmotor. = gsub(" ccm", "", Hubraum..Verbrennungsmotor.),
         Hubraum..Verbrennungsmotor. = as.numeric(Hubraum..Verbrennungsmotor.)) %>% 
  rename(Hubraumgröße = Hubraum..Verbrennungsmotor.)

# Verbrauch.Gesamt..NEFZ. zu numeric machen
data <- data %>% 
  mutate(Verbrauch.Gesamt..NEFZ. = gsub(" l/100 km| kWh/100 km| kg/100 km", "", Verbrauch.Gesamt..NEFZ.),
         Verbrauch.Gesamt..NEFZ. = gsub(",", ".", Verbrauch.Gesamt..NEFZ.),
         Verbrauch.Gesamt..NEFZ. = as.numeric(Verbrauch.Gesamt..NEFZ.)) %>% 
  rename(Verbrauch.gesamt.in.l.kg.kWh_100Km = Verbrauch.Gesamt..NEFZ.)

# Leergewicht..EU. zu. numeric machen
data <- data %>%
  mutate(Leergewicht..EU. = gsub(" kg$", "", Leergewicht..EU.),
         Leergewicht..EU. = as.numeric(Leergewicht..EU.)) %>% 
  rename(Leergewicht..EU.in.kg = Leergewicht..EU.)

# C02.Ausstoß zum ADAC-Ecotest Wert transfomieren und zu numeric machen
data <- data %>% 
  mutate(C02.Ausstoß = gsub("n.b.", "-", C02.Ausstoß),
         C02.Ausstoß = gsub(" g pro km\\(.*\\)", "", C02.Ausstoß),
         C02.Ausstoß = gsub("[[:digit:]-]+ / ", "", C02.Ausstoß),
         C02.Ausstoß = as.numeric(C02.Ausstoß)) %>% 
  rename(CO2.ADAC.Test = C02.Ausstoß)

# Gesamtpunktzahl zu numeric machen
data <- data %>% 
  mutate(Gesamtpunktzahl = gsub(" Punkte", "", Gesamtpunktzahl),
         Gesamtpunktzahl = as.numeric(Gesamtpunktzahl))

# Grundpreis zu numeric machen
data <- data %>% 
  mutate(Grundpreis = gsub(" Euro", "", Grundpreis),
         Grundpreis = ifelse(Grundpreis == "-", NA, Grundpreis),
         Grundpreis = as.numeric(Grundpreis))

# Reichweite.WLTP..elektrisch. zu numeric machen
data <- data %>% 
  mutate(Reichweite.WLTP..elektrisch. = gsub(" km", "", Reichweite.WLTP..elektrisch.),
         Reichweite.WLTP..elektrisch. = as.numeric(Reichweite.WLTP..elektrisch.)) %>% 
  rename(Reichweite.elektrisch.in.km = Reichweite.WLTP..elektrisch.)

#Batteriekapazität..Netto..in.kWh zu numeric machen
data <- data %>% 
  mutate(Batteriekapazität..Netto..in.kWh = gsub(",", ".", Batteriekapazität..Netto..in.kWh),
         Batteriekapazität..Netto..in.kWh = as.numeric(Batteriekapazität..Netto..in.kWh))

#top n marken rausfiltern 
data %>%
  count(Marke) %>%
  top_n(5, n) %>%
  pull(Marke) -> top_Marken

# top n marken deutsch / ausländisch + kombiniert
data %>% filter(deutscher.Hersteller != "deutsch") %>% select(Marke) %>% count(Marke) %>% top_n(3, n) %>% pull(Marke) -> top_ausländische_Marken
data %>% filter(deutscher.Hersteller == "deutsch") %>% select(Marke) %>% count(Marke) %>% top_n(3, n) %>% pull(Marke) -> top_deutsche_Marken
top_weltweit_marken <- c(top_ausländische_Marken, top_deutsche_Marken)

#top n marken aus Europa 
marke_Europa <- c("Mercedes-Benz", "MINI", "Opel", "Peugeot", "Renault", "SEAT", "Porsche", "Rover", "Skoda", "smart", 
                  "Alfa Romeo", "ALPINA", "Audi", "BMW", "Citroen", "CUPRA", "Dacia", "DS Automobiles", "Fiat", "Maserati",
                  "Volvo", "VW", "VW Nutzfahrzeuge")

# Spalten erstellen mit europäisch / nicht europäisch
data <- data %>% 
  mutate(europäischer.Hersteller = Marke %in% marke_Europa,
         europäischer.Hersteller = ifelse(europäischer.Hersteller, "europäisch", "nicht europäisch"))

# top marken eu / nicht eu 
data %>% filter(europäischer.Hersteller != "europäisch") %>% select(Marke) %>% count(Marke) %>% top_n(3, n) %>% pull(Marke) -> top_nicht_europäische_Marken
data %>% filter(europäischer.Hersteller == "europäisch") %>% select(Marke) %>% count(Marke) %>% top_n(3, n) %>% pull(Marke) -> top_europäische_Marken
eu_nicht_eu_marken <- c(top_europäische_Marken, top_nicht_europäische_Marken)

# remove Euro + set as numeric für Laufende Kosten
data <- data %>% mutate(Betriebskosten = gsub(" €$", "", Betriebskosten)) %>%
  mutate(Fixkosten = gsub(" €$", "", Fixkosten)) %>%
  mutate(Werkstattkosten = gsub(" €$", "", Werkstattkosten)) %>% 
  mutate(KFZ.Steuer.ohne.Befreiung.Jahr..kann.durch.WLTP.abweichen. = gsub(" Euro$", "", KFZ.Steuer.ohne.Befreiung.Jahr..kann.durch.WLTP.abweichen.)) %>%
  mutate(Wertverlust = gsub(" €$", "", Wertverlust)) %>%
  mutate(Haftpflichtbeitrag.100. = gsub("€$", "", Haftpflichtbeitrag.100.)) %>%
  mutate(Betriebskosten = as.numeric(Betriebskosten)) %>% 
  mutate(Fixkosten = as.numeric(Fixkosten)) %>% 
  mutate(Werkstattkosten = as.numeric(Werkstattkosten)) %>% 
  mutate(KFZ.Steuer.ohne.Befreiung.Jahr..kann.durch.WLTP.abweichen. = as.numeric(KFZ.Steuer.ohne.Befreiung.Jahr..kann.durch.WLTP.abweichen.)) %>% 
  mutate(Haftpflichtbeitrag.100. = as.numeric(Haftpflichtbeitrag.100.)) %>% 
  mutate(Wertverlust = as.numeric(Wertverlust))

# remove mm + set as numeric für Größe 
data <- data %>% mutate(Länge = gsub(" mm$", "", Länge)) %>%
                 mutate(Breite = gsub(" mm$", "", Breite)) %>%
                 mutate(Höhe = gsub(" mm$", "", Höhe)) %>% 
                 mutate(Länge = as.numeric(Länge)) %>% 
                 mutate(Höhe = as.numeric(Höhe)) %>% 
                 mutate(Breite = as.numeric(Breite))

# Interssante Karosserie
interssante_Karosserie <- c("Coupe", "Bus", "Van", "Kombi", "Schrägheck", "SUV")

# anlass vereinfachen in nullen und einsen
data <- data %>% mutate(Fehler_ja_nein = ifelse(is.na(Anlass), 0, 1))

# in deutsche und weltweit betroffene Fahrzeuge aufteilen
data <- data %>% mutate(Deutschlandweit.betroffene.Fahrzeuge = str_extract(Anzahl.betroffener.Fahrzeuge, "\\d+\\.\\d+"),
                        Weltweit.betroffene.Fahrzeuge = str_extract(Anzahl.betroffener.Fahrzeuge, "(?<=\\)\\s)\\d+\\.\\d+"))

#Ladezeiten collumn umschreiben
#collumn mit einträgen von 100%: __ min. (AC Schuko 2,8 kW) erstellen
data$Ladezeiten_Schuko.2.3kW <- data$Ladezeiten
#Der folgende Ansatz funktioniert da die Daten welche "AC Schuko 2,3 kW" beinhalten einheitlich sind
data <- data %>%
  mutate(Ladezeiten_Schuko.2.3kW = ifelse(grepl("AC Schuko 2,3 kW", Ladezeiten_Schuko.2.3kW), Ladezeiten_Schuko.2.3kW, NA))

data$Ladezeiten_Schuko.2.3kW <- str_extract(data$Ladezeiten_Schuko.2.3kW, pattern = " (?<=\\s)\\d+")
data$Ladezeiten_Schuko.2.3kW <- gsub(" ", "", data$Ladezeiten_Schuko.2.3kW)
data$Ladezeiten_Schuko.2.3kW <- as.numeric(data$Ladezeiten_Schuko.2.3kW)

#Reichweite Verbrenner:
#Verbrauch.Gesamt..NEFZ. (l/100 km) nach Verbrenner filtern
#Tankgröße
# R = T/(v/100)
data2 <- data %>%
  mutate(Tankgröße = gsub(" l", "", Tankgröße),
         Tankgröße = gsub(",", ".", Tankgröße),
         Tankgröße = as.numeric(Tankgröße)) 
Verbrauch_pro_km <- data2$Verbrauch.gesamt.in.l.kg.kWh_100Km / 100
data2$Reichweite <- data2$Tankgröße/Verbrauch_pro_km

#joined collumn
data2$Reichweite.Gesamt <- coalesce(data2$Reichweite.elektrisch.in.km, data2$Reichweite)

#Leistung.in.kW ergänzen
data$Leistung.in.kW <- gsub(" kW", "", data$Leistung)
data$Leistung.in.kW <- as.numeric(data$Leistung.in.kW)
```

Thema 1

CO2-Effizienzklasse: Gibt die CO2-Effizienzklasse des Autos an.
Anschauen mit: Modellstart,  Leistung, Fahrzeugklassen
+
CO2.Wert..NEFZ.: Gibt den CO2-Ausstoß des Autos in g/km an.
```{r}
#relative Verteilung der Effizienzklassen über die Zeit (Abgasskandal 2015)
data %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>%
  mutate(Anzahl.Jahr = n()) %>%
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), CO2.Effizienzklasse) %>%
  mutate(Anzahl.Jahr.CO2.Effizienzklasse = n()) %>%
  drop_na(CO2.Effizienzklasse) %>%
  mutate(relativ.CO2.Effizienzklasse = Anzahl.Jahr.CO2.Effizienzklasse / Anzahl.Jahr) %>%   
  ggplot(aes(x = Baureihenstart, y = relativ.CO2.Effizienzklasse, color = CO2.Effizienzklasse)) + 
  geom_line() + 
  labs(title = "Effizienzklassenverteilung", x = "Baureihenstart", y = "relative Häufigkeiten", color = "CO2.Effizienzklasse")

#Leistung über Zeit in Effizienzklassenverteilung
data %>% group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>%
  mutate(Anzahl.Jahr = n()) %>%
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), CO2.Effizienzklasse) %>%
  drop_na(Leistung.in.kW) %>% 
  mutate(Leistung.in.kW = mean(Leistung.in.kW)) %>% 
  ggplot(aes(x = Baureihenstart, y = Leistung.in.kW, color = CO2.Effizienzklasse)) + 
  geom_line() + 
  labs(title = "Leistung über Zeit in Effizienzklassenverteilung", x = "Baureihenstart", y = "Leistung in kW", color = "CO2.Effizienzklasse")

avg_leistung <- data %>%
  group_by(CO2.Effizienzklasse) %>%
  summarise(avg_Leistung = mean(Leistung.in.kW, na.rm = TRUE))

#bar plot Leistung nach Effizienzklasse
ggplot(avg_leistung, aes(x = CO2.Effizienzklasse, y = avg_Leistung)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(x = "CO2 Effizienzklasse", y = "Average Leistung in kW") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Allgemeine Entwicklung CO2 Ausstoß (zeitliche Entwicklung)
data %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>% # Vllt. ohne floor_date, aber dann geom_line mit geom_point ersetzen
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  mutate(CO2.Ausstoß = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Baureihenstart, y = CO2.Ausstoß)) +
  geom_line() + 
  labs(
    title = "Allgemeine Entwicklung des CO2-Ausstoßes",
    y = "CO2-Ausstoß in g/km"
  )

# Entwicklung CO2 Ausstoß pro Fahrzeugklasse (zeitliche Entwicklung)
data %>% 
  mutate(Fahrzeugklasse = gsub("Kleinstwagen|Microwagen", "Kleinwagen", Fahrzeugklasse)) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Fahrzeugklasse) %>% # Vllt. ohne floor_date, aber dann geom_line mit geom_point ersetzen
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  mutate(CO2.Ausstoß = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Baureihenstart, y = CO2.Ausstoß, color = Fahrzeugklasse)) +
  geom_line() +
  labs(
    title = "Entwicklung des CO2-Ausstoßes nach Fahrzeugklassen",
    y = "Durchschnittlicher CO2-Ausstoß in g/km"
  )

#CO2.Ausstoß_g.pro.km über Leistung.in.kW
#smooth plot
data %>% 
  group_by(Leistung.in.kW) %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  summarise(CO2.Ausstoß = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Leistung.in.kW, y = CO2.Ausstoß)) +
  geom_point() +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(
    title = "CO2-Ausstoß nach Leistung in kW",
    x = "kW",
    y = "CO2-Ausstoß in g/km"
  )
#pointplot
data %>% 
  group_by(Leistung.in.kW) %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  summarise(CO2.Ausstoß = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Leistung.in.kW, y = CO2.Ausstoß)) +
  geom_line() +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(
    title = "CO2-Ausstoß nach Leistung in kW",
    x = "kW",
    y = "CO2-Ausstoß in g/km"
  )

#CO2-Ausstoß nach Baureihenstart gruppiert nach Leistung in PS für Verbrenner
data %>% 
  filter(Motorart == "Verbrenner") %>% 
  mutate(Leistung.maximal.in.PS..Systemleistung. = cut(Leistung.maximal.in.PS..Systemleistung.,
                                                       breaks = c(0, 120, 180, 300, Inf))) %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Leistung.maximal.in.PS..Systemleistung.) %>% 
  mutate(CO2.Ausstoß = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Baureihenstart, y = CO2.Ausstoß, color = Leistung.maximal.in.PS..Systemleistung.)) +
  geom_line() +
  labs(
    title = "CO2-Ausstoß nach Baureihenstart gruppiert nach Leistung in PS (Verbrennermotor)",
    y = "CO2-Ausstoß in g/km",
    color = "PS"
  ) +
  scale_color_discrete(labels = c("<120", "120-180", "180-300", "300<"))
```

Thema 2

Grundpreis: Gibt den Preis des Autos in Euro an. (gibt ne seperate Note/ Punkte für den Preis/Kosten)
Anschauen mit: Baureihenstart 
Laufende Kosten: Baureihenstart (Weltfinanzkrise 2007/8) (Eurokrise - deutsche/ausländische vergleichen wegen Auswirkungen)
```{r}
# (Inflation ?) + Weltfinanzkrise 2007/8 + Eurokrise 2010

# der Durschnittspreis über der Zeit pro Antriebsart
data %>% 
  group_by(Motorart, Baureihenstart) %>%
  mutate(Prize_average = mean(Grundpreis, na.rm = TRUE)) %>% 
  ggplot(aes(x = Baureihenstart, y = Prize_average, color = Motorart)) +
  geom_smooth(method = "loess", span = 0.4, se = FALSE) + 
  labs(title = "Durchschnittspreis pro Antriebsart über die Zeit", 
       x = "Zeit", 
       y = "Durchschnittspreis in €", 
       color = "Antriebsart")

# Vergleich zwischen europäischen und nicht europäischen Marken 

data %>% filter(Marke %in% eu_nicht_eu_marken ) %>% 
  group_by(Marke, Baureihenstart) %>%
  mutate(Prize_average = mean(Grundpreis, na.rm = TRUE)) %>% 
  ggplot(aes(x = Baureihenstart, y = Prize_average, color = Marke)) +
  geom_smooth(method = "loess", span = 0.4, se = FALSE) + 
  labs(title = "Durchschnittspreis pro Automarke über die Zeit", 
     x = "Zeit", 
     y = "Durchschnittspreis in €")

# Grundpreis pro Marke für CO2-Effizienzklassen 
data %>% filter(Marke %in% eu_nicht_eu_marken ) %>% 
  filter(!is.na(CO2.Effizienzklasse)) %>%
  ggplot(aes(x = CO2.Effizienzklasse, y = Grundpreis, fill = Marke)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge") +
    labs(title = "Durchschnittspreis nach CO2-Effizienzklasse und Marke",
       x = "CO2-Effizienzklasse",
       y = "Durchschnittspreis in €",
       fill = "Marke")

# Grundpreis pro Marke für CO2-Effizienzklassen 
data %>% filter(!is.na(CO2.Effizienzklasse)) %>%
  ggplot(aes(x = CO2.Effizienzklasse, y = Grundpreis)) +
  geom_boxplot() +
    labs(title = "Durchschnittspreis nach CO2-Effizienzklasse und Marke",
       x = "CO2-Effizienzklasse",
       y = "Durchschnittspreis in €")

### Laufende Kosten 


# Fixkosten ohne Wertverlust (da erst die letzten 2 Jahre erfasst) über die Zeit 
data %>% 
  group_by(Motorart, Baureihenstart) %>%
  mutate(Laufendekosten = sum(c(Betriebskosten, Werkstattkosten, Fixkosten, KFZ.Steuer.ohne.Befreiung.Jahr..kann.durch.WLTP.abweichen., Haftpflichtbeitrag.100.))) %>% 
  ggplot(aes(x = Baureihenstart, y = Laufendekosten, color = Motorart)) +
  geom_smooth(method = "loess", span = 0.3, se = FALSE) + 
  ylim(0, NA) +
  labs(title = "Laufende Kosten pro Motorart", 
       x = "Zeit", 
       y = "Laufendekosten in €")

# Laufende kosten im vergleich mit Antriebsart (ohne "Haftpflichtbeitrag.100." da bei allen gleich)
pivot_cols_Fix <- c("Betriebskosten", "Werkstattkosten", "Fixkosten", "KFZ.Steuer.ohne.Befreiung.Jahr..kann.durch.WLTP.abweichen.") 
df_long_Fix <- data %>% pivot_longer(cols = all_of(pivot_cols_Fix), names_to = "Position", values_to = "Fixkosten")

df_long_Fix %>% ggplot(aes(x = Motorart, y = Fixkosten, fill = Position)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Laufende Kosten nach Antriebsart",
       x = "Antriebsart",
       y = "Aufsummierte Fixkosten in €",
       fill = "Position")

# Laufende kosten im vergleich mit Antriebsart mit Wertverlust
pivot_cols_Fix_2 <- c("Betriebskosten", "Werkstattkosten", "Fixkosten", "KFZ.Steuer.ohne.Befreiung.Jahr..kann.durch.WLTP.abweichen.", "Wertverlust") 
df_long_Fix_2 <- data %>% pivot_longer(cols = all_of(pivot_cols_Fix_2), names_to = "Position", values_to = "Fixkosten")

df_long_Fix_2 %>% ggplot(aes(x = Motorart, y = Fixkosten, fill = Position)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Laufende Kosten nach Antriebsart mit Wertverlust",
       x = "Antriebsart",
       y = "Aufsummierte Fixkosten in €",
       fill = "Position")
```
Erkenntnisse :

Preise für Elektro/Gas sind seit 2010 gestiegen und fallen seit 2020.
Preise für Hybrid sind generell höher als Verbrenner und schwankt, seit 2022 ist Hybrid billiger als Verbrenner (war er noch nie vorher).
Verbrenner Preise steigen kontinuierlich seit ca 2003.
Deutsche Marken generll teurer als ausländische Konkurenz und Preise steigen generell.
Zweit Schlechteste Effizienzklasse ist am günstigsten die schlechteste ist eine der Teuersten und die deutschen Autobauer sind am Teuersten in jeder Klasse.
Laufende kosten ist bei Verbrenner am höchsten seit 2010 am sinken, seit 2021 sinken die laufenden Kosten bei allen Motorarten.
Laufende Kosten bei Elektor/Gas am geringsten bei Hybrid die Werkstattkosten am teuersten bei Verbrenner die KFZ Steuer.
Der Wertverlust ist bei Elektro am höchsten bei Verbrenner am niedrigsten. 








Thema 3

Motorart: Gibt die Motorart des Autos an. (Vllt. in allgeimeine Werte umwandeln, z.B. Verbrenner, Elektro, etc.)
Anschauen mit: Modellstart (Entwicklung zu Elektroautos erkennbar?)
```{r}
# Häufigkeit der einzelnen Motorarten
ggplot(data, aes(x = Motorart)) + 
  geom_bar() +
  labs(
    title = "Häufigkeit der einzelnen Motorarten",
    y = "Anzahl"
  )

# Häufigkeiten der einzelnen Motorarten als Vergleich zwischen deutschen und ausländischen Herstellern
ggplot(data, aes(x = Motorart, fill = deutscher.Hersteller)) +
  geom_bar(position = "dodge") +
  labs(
    title = "Vergleich zwischen deutschen und ausländischen Herstellern",
    y = "Anzahl",
    fill = "Hersteller"
  )

# Relative Häufigkeiten der einzelnen Motorarten als Vergleich zwischen deutschen und ausländischen Herstellern
data %>% 
  group_by(Motorart) %>%
  mutate(Anzahl.Motorart = n()) %>% 
  group_by(Motorart, deutscher.Hersteller) %>%
  mutate(Anzahl.Hersteller.Motorart = n()) %>% 
  mutate(relativ.Motorart = Anzahl.Hersteller.Motorart / Anzahl.Motorart) %>% 
  ggplot(aes(x = Motorart, y = relativ.Motorart, fill = deutscher.Hersteller)) +
  geom_col(position = "dodge") +
  labs(
    title = "relativer Vergleich zwischen deutschen und ausländischen Herstellern",
    y = "relative Häufigkeit",
    fill = "Hersteller"
  )

# Häufigkeit der Motorarten nach Baureihenstart (zeitliche Entwicklung)
data %>% 
  #mutate(
  #  Motorart = ifelse(Motorart %in% c("Diesel", "Otto"), "Verbrenner", ifelse(Motorart %in% "Hybrid", "Hybrid", "Elektro/Gas"))) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Motorart) %>% 
  count() %>% 
  ggplot(aes(x = Baureihenstart, y = n, color = Motorart)) +
  geom_line() +
  labs(y = "Anzahl")

# Relative Häufigkeit der Motorarten nach Baureihenstart (zeitliche Entwicklung)
data %>% 
  #mutate(
  #  Motorart = ifelse(Motorart %in% c("Diesel", "Otto"), "Verbrenner", ifelse(Motorart %in% "Hybrid", "Hybrid", "Elektro/Gas"))) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>%
  mutate(Anzahl.Jahr = n()) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Motorart) %>%
  mutate(Anzahl.Jahr.Motorart = n()) %>% 
  mutate(relativ.Motorart = Anzahl.Jahr.Motorart / Anzahl.Jahr) %>% 
  ggplot(aes(x = Baureihenstart, y = relativ.Motorart, color = Motorart)) +
  geom_line() +
  labs(
    title = "Relative Häufigkeit der Motorarten nach Baureihenstart",
    y = "relative Häufigkeit"
  )

# Vergleich der Entwicklung der Motorarten zwischen deutschen und ausländischen Herstellern
data %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), deutscher.Hersteller) %>%
  mutate(Anzahl.Jahr = n()) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), deutscher.Hersteller, Motorart) %>%
  mutate(Anzahl.Jahr.Motorart = n()) %>% 
  mutate(relativ.Motorart = Anzahl.Jahr.Motorart / Anzahl.Jahr) %>% 
  ggplot(aes(x = Baureihenstart, y = relativ.Motorart, color = Motorart)) +
  geom_line() +
  facet_wrap(~deutscher.Hersteller) +
  labs(
    title = "Relative Häufigkeit der Motorarten nach Baureihenstart",
    y = "relative Häufigkeit"
  )
```

Thema 4

Leistung.maximal.in.PS..Systemleistung.: Gibt die maximale PS des Autos an.  # Vllt. in kW angeben, da das die offizielle Angabe ist?
Anschauen mit: Modellstart, CO2-Ausstoß, Motorart, Hubraumgröße, Leistung/Gewicht verhältniss (bei Alex)
```{r}
# Leistung in PS nach Baureihenstart (zeitliche Entwicklung)
data %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>% 
  summarise(Leistung.in.PS = mean(Leistung.maximal.in.PS..Systemleistung.)) %>% 
  ggplot(aes(x = Baureihenstart, y = Leistung.in.PS)) +
  geom_line() +
  labs(
    title = "Leistung in PS nach Baureihenstart",
    y = "PS"
  )

# CO2-Ausstoß nach Leistung in PS
data %>% 
  group_by(Leistung.maximal.in.PS..Systemleistung.) %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  summarise(CO2.Ausstoß = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Leistung.maximal.in.PS..Systemleistung., y = CO2.Ausstoß)) +
  geom_point() +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(
    title = "CO2-Ausstoß nach Leistung in PS",
    x = "PS",
    y = "CO2-Ausstoß in g/km"
  )

# Maximale Leistung nach Motorarten
data %>% 
  #mutate(
  #  Motorart = ifelse(Motorart %in% c("Diesel", "Otto"), "Verbrenner", ifelse(Motorart %in% "Hybrid", "Hybrid", "Elektro/Gas"))) %>% 
  group_by(Motorart) %>% 
  summarise(Leistun.in.PS = max(Leistung.maximal.in.PS..Systemleistung.)) %>% 
  ggplot(aes(x = Motorart, y = Leistun.in.PS)) +
  geom_col() + 
  labs(
    title = "Maximale Leistung in PS nach Motorart",
    y = "PS"
  )

# Maximale Leistung in PS der Motorarten nach Baureihenstart (zeitliche Entwicklung)
data %>% 
  #mutate(
  #  Motorart = ifelse(Motorart %in% c("Diesel", "Otto"), "Verbrenner", ifelse(Motorart %in% "Hybrid", "Hybrid", "Elektro/Gas"))) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Motorart) %>% 
  mutate(Leistung.in.PS = mean(Leistung.maximal.in.PS..Systemleistung.)) %>% 
  ggplot(aes(x = Baureihenstart, y = Leistung.in.PS, color = Motorart)) +
  geom_smooth(se = FALSE) + # Vllt durch geom_point oder geom_line ersetzen?
  labs(
  title = "Leistung in PS der Motorarten nach Baureihenstart",
  y = "PS"
  )

# Leistung in PS nach Hubraumgröße
data %>% 
  drop_na(Hubraumgröße) %>% 
  group_by(Hubraumgröße) %>% 
  summarise(Leistung.in.PS = mean(Leistung.maximal.in.PS..Systemleistung.)) %>% 
  ggplot(aes(x = Hubraumgröße, y = Leistung.in.PS)) + 
  geom_point() +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(
    title = "Leistung in PS nach Hubraumgröße",
    y = "PS"
  )

# CO2-Ausstoß nach Baureihenstart gruppiert nach Leistung in PS für Verbrenner
data %>% 
  filter(Motorart == "Verbrenner") %>% 
  mutate(Leistung.maximal.in.PS..Systemleistung. = cut(Leistung.maximal.in.PS..Systemleistung.,
                                                       breaks = c(0, 120, 180, 300, Inf))) %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Leistung.maximal.in.PS..Systemleistung.) %>% 
  mutate(CO2.Ausstoß = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Baureihenstart, y = CO2.Ausstoß, color = Leistung.maximal.in.PS..Systemleistung.)) +
  geom_line() +
  labs(
    title = "CO2-Ausstoß nach Baureihenstart gruppiert nach Leistung in PS (Verbrennermotor)",
    y = "CO2-Ausstoß in g/km",
    color = "PS"
  ) +
  scale_color_discrete(labels = c("<120", "120-180", "180-300", "300<"))

# Verhältniss von Gewicht zu Leistung nach Baureihenstart gruppiert gruppiert nach Motorart
data %>%
  drop_na(Leergewicht..EU.in.kg) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Motorart) %>% 
  mutate(Verhältnis = Leergewicht..EU.in.kg / Leistung.maximal.in.PS..Systemleistung.) %>% 
  ggplot(aes(x = Baureihenstart, y = Verhältnis, color = Motorart)) + 
  geom_smooth(method = "loess", se = FALSE) + 
  labs(
    title = "Leistungsgewicht abhängig von Motorart",
    y = "Leistungsgewicht in kg/PS",
    color = "Motorart"
  )
```

Thema 5

Hubraum..Verbrennungsmotor. / Hubraum: Gibt die Hubraumgröße des Motors des Autos in ccm an.
Anschauen mit: Modellstart, CO2-Ausstoß, CO2-Effizienzklasse, Treibstoffverbrauch, Leistung (bei Daniel)
```{r}
# Hubraumgröße in ccm nach Baureihenstart (zeitliche Entwicklung)
data %>% 
  drop_na(Hubraumgröße) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>% 
  summarise(Hubraumgröße = mean(Hubraumgröße)) %>% 
  ggplot(aes(x = Baureihenstart, y = Hubraumgröße)) +
  geom_line() +
  labs(
    title = "Hubraumgröße nach Baureihenstart",
    y = "Hubraumgröße in ccm"
  )

# CO2-Ausstoß nach Hubraumgröße in ccm für Verbrenner
data %>% 
  filter(Motorart == "Verbrenner") %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  group_by(Hubraumgröße) %>% 
  summarise(CO2.Ausstoß = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Hubraumgröße, y = CO2.Ausstoß)) + 
  geom_point() +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(
    title = "CO2-Ausstoß nach Hubraumgröße (Verbrenner)",
    x = "Hubraumgröße in ccm",
    y = "CO2-Ausstoß in g/km"
  )

# Treibstoffverbrauch nach Hubraumgröße
data %>% 
  filter(Motorart == "Verbrenner") %>% 
  drop_na(Verbrauch.gesamt.in.l.kg.kWh_100Km) %>% 
  group_by(Hubraumgröße) %>% 
  summarise(Verbrauch.in.l_pro_100km = mean(Verbrauch.gesamt.in.l.kg.kWh_100Km)) %>% 
  ggplot(aes(x = Hubraumgröße, y = Verbrauch.in.l_pro_100km)) +
  geom_point() +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(
    title = "Treibstoffverbrauch nach Hubraumgröße",
    y = "Verbrauch in l/100km"
  )

# CO2-Ausstoß nach Baureihenstart gruppiert nach Hubraumgröße in ccm für Verbrenner
data %>% 
  filter(Motorart == "Verbrenner") %>% 
  mutate(Hubraumgröße = cut(Hubraumgröße, breaks = c(0, 1500, 2000, 3000, Inf))) %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Hubraumgröße) %>% 
  mutate(CO2.Ausstoß = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Baureihenstart, y = CO2.Ausstoß, color = Hubraumgröße)) +
  geom_line() +
  labs(
    title = "CO2-Ausstoß nach Baureihenstart gruppiert nach Hubraumgröße (Verbrennermotor)",
    y = "CO2-Ausstoß in g/km",
    color = "ccm"
  ) +
  scale_color_discrete(labels = c("<1500", "1500-2000", "2000-3000", "3000<"))
```

Thema 6

Länge, Breite, Höhe -> Größe/Volumen: Gibt das Volumen des Autos in mm^3/m^3 an.
Anschauen mit: Modellstart (Autos werden immer größer), Hubraumgröße, CO2-Ausstoß, PS, Treibstoffverbrauch (bei Alex)
+
Leergewicht..EU.: Gibt das Leergewicht des Autos in kg an.
Anschauen mit: Verbrauch, Modellstart, CO2-Effizienzklasse, CO2-Ausstoß
+
Karosserieform
Anschauen mit: Höchstgescwindigkeit und Verbrauch
```{r}
# Größe des Autos im Vergleich zur Zeit  
data %>% filter(Marke %in% eu_nicht_eu_marken) %>% 
  group_by(Marke, Baureihenstart) %>% 
  mutate(Volumen = (Länge * Breite * Höhe) / 1000000) %>% 
  ggplot(aes(x = Baureihenstart, y = Volumen, color = Marke)) + 
  geom_smooth(method = "loess", span = 0.4, se = FALSE, na.rm = TRUE) + 
  labs(title = "Größe pro Zeit", 
       x = "Zeit", 
       y = "Größe in Liter", 
       color = "Marke")

# Größe des Autos im Vergleich zur Zeit udn Antriebsart
data %>% group_by(Motorart, Baureihenstart) %>% 
  mutate(Volumen = (Länge * Breite * Höhe) / 1000000) %>% 
  ggplot(aes(x = Baureihenstart, y = Volumen, color = Motorart)) + 
  geom_smooth(method = "loess", span = 0.4, se = FALSE, na.rm = TRUE) + 
  labs(title = "Größe pro Zeit", 
       x = "Zeit", 
       y = "Größe in Liter", 
       color = "Marke")

# Leistungsgewicht in abhängigkeit von der Antriebsart
data %>% group_by(Motorart, Baureihenstart) %>% 
  mutate(Verhältnis = Leistung.maximal.in.PS..Systemleistung./Leergewicht..EU.in.kg) %>% 
  ggplot(aes(x = Baureihenstart, y = Verhältnis, color = Motorart)) + 
  geom_smooth(method = "loess", span = 0.7, se = FALSE, na.rm = TRUE) + 
  labs(title = "Leistungsgewicht in PS/kg abhängig von Antriebsart", 
       x = "Zeit", 
       y = "Leistungsgewicht in PS/kg", 
       color = "Antriebsart")

# Verhältniss Karosserie relativ zur Zeit
data %>% filter(Karosserie %in% interssante_Karosserie) %>%
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>%
  mutate(Anzahl.Jahr = n()) %>%
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Karosserie) %>%
  mutate(Anzahl.Jahr.Karosserie = n()) %>%
  mutate(relativ.Karosserie = Anzahl.Jahr.Karosserie / Anzahl.Jahr) %>%   
  ggplot(aes(x = Baureihenstart, y = relativ.Karosserie, color = Karosserie)) + 
  geom_line() + 
  labs(title = "relative Verteilung der Karosserieformen", 
       x = "Zeit", 
       y = "relative Häufigkeiten", 
       color = "Karosserieform")

# Verhältniss Karosserievorm zu Verbrauch (Verbrenner)
data %>% filter(Motorart == "Verbrenner") %>%
  filter(Karosserie %in% interssante_Karosserie) %>%
  group_by(Karosserie, Baureihenstart) %>%
  mutate(Verbrauch_Durchschnitt = mean(Verbrauch.gesamt.in.l.kg.kWh_100Km)) %>%
  ggplot(aes(x = Baureihenstart, y = Verbrauch_Durchschnitt, color = Karosserie)) +
  geom_smooth(method = "loess", span = 0.7, se = FALSE, na.rm = TRUE) +   
  labs(title = "Verbrauch pro Karosserieform (Verbrenner)", 
       x = "Zeit", 
       y = "Verbrauch in Liter", 
       color = "Karosserieform")

# Leergewicht zu CO2 Ausstoß 
  
data %>% mutate(Verhältniss = Leergewicht..EU.in.kg/CO2.Ausstoß_g.pro.km)%>% 
  ggplot(aes(x = Baureihenstart, y = Verhältniss, color = Motorart)) + 
  geom_smooth(method = "loess", span = 0.7, se = FALSE, na.rm = TRUE) +   
  labs(title = "Verhältnis von Gewicht des Autos in kg zu g C02 Ausstoß", 
       x = "Zeit", 
       y = "kg Gewicht / g Ausstoß", 
       color = "Antriebsart")  
```
Erkenntnisse:

Autos werden immer größer unabhänig von der Marke.
Das Leistungsgewicht steigt bei Elektor/Gas Autos und stagniert bei Verbrenner und Hybrid.
Anteil an SUV stark gestiegen seit 2010, liegt bei ca 50% danch Schrägheck und Kombi.
Verbrauch gesunken und seit 2015 steigen bis auf SUV, VAN und BUS diese fallen.
Bei Hybrid der höchste Ausstoß an CO pro KG Autogewicht ????







Thema 7

C02.Ausstoß: Gibt den Vergleich zwischen dem CO2-Ausstoß nach Herstellerangabe und dem ADAC Ecotest an.
Anschauen mit: Verhältnis zwischen angaben und realität (Diesel skandal sichtbar ?), Top X Marken oder deutsch ausländisch etc., Fahrzeugklasse
+
Verbrauch: Gibt den Vergleich zwischen dem Verbrauch nach Herstellerangabe und dem ADAC Ecotest an.

```{r}
# Verhältnis von CO2-Ausstoß ADAC-Ecotest und Herstellerangbe
data %>% 
  filter(CO2.Ausstoß_g.pro.km != 0) %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  mutate(CO2.Verhältnis = CO2.ADAC.Test / CO2.Ausstoß_g.pro.km) %>% 
  ggplot(aes(x = CO2.Verhältnis)) +
  geom_density() +
  geom_vline(xintercept = 1, color = "red") +
  labs(
    title = "Verteilung vom Verhältnis von CO2-Ausstoß ADAC-Ecotest und Herstellerangbe",
    x = "Verhältnis (ADAC-Ecotest / Herstellerangabe)"
  )

# Verhältnis von CO2-Ausstoß ADAC-Ecotest und Herstellerangbe nach Baureihenstart
data %>% 
  filter(CO2.Ausstoß_g.pro.km != 0) %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  mutate(CO2.Verhältnis = CO2.ADAC.Test / CO2.Ausstoß_g.pro.km) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>% 
  mutate(CO2.Verhältnis = mean(CO2.Verhältnis)) %>% 
  ggplot(aes(x = Baureihenstart, y = CO2.Verhältnis)) +
  geom_line() +
  labs(
    title = "Verhältnis von CO2-Ausstoß ADAC-Ecotest und Herstellerangbe nach Baureihenstart",
    y = "Verhältnis (ADAC-Ecotest / Herstellerangabe)"
  )

# Verhältnis von CO2-Ausstoß ADAC-Ecotest und Herstellerangbe (zwei Linien)
data %>% 
  filter(CO2.Ausstoß_g.pro.km != 0) %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), deutscher.Hersteller) %>% 
  mutate(CO2.ADAC.Test = mean(CO2.ADAC.Test),
         CO2.Ausstoß_g.pro.km = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Baureihenstart)) +
  geom_line(aes(y = CO2.ADAC.Test, color = "red")) +
  geom_line(aes(y = CO2.Ausstoß_g.pro.km, color = "blue")) +
  facet_wrap(~deutscher.Hersteller)

# Verhältnis von CO2-Ausstoß ADAC-Ecotest und Herstellerangbe (zwei Linien)
data %>% 
  filter(CO2.Ausstoß_g.pro.km != 0) %>% 
  drop_na(CO2.Ausstoß_g.pro.km) %>% 
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>% 
  mutate(CO2.ADAC.Test = mean(CO2.ADAC.Test),
         CO2.Ausstoß_g.pro.km = mean(CO2.Ausstoß_g.pro.km)) %>% 
  ggplot(aes(x = Baureihenstart)) +
  geom_line(aes(y = CO2.ADAC.Test, color = "red")) +
  geom_line(aes(y = CO2.Ausstoß_g.pro.km, color = "blue"))
```

Thema 8

Elektroautos:

Ladezeiten: Gibt die Ladezeiten der Elektroautos bis zu 100% in Minuten für verschiedene Anschlüsse an.
Anschauen mit: Batteriekapazität, Modellstart, Marke
+
Reichweite.WLTP..elektrisch.: Gibt die Reichweite für Elektroautos in km an.
Anschauen mit: Batteriekapazität, Modellstart, Marke (Vergleich mit der Reichweite von Verbrenner (muss berechnet werden))
+
Batteriekapazität..Netto..in.kWh: Gibt die Batteriekapazität der Autos in kWh an. (Hauptsächlich interessant für Elektroautos)
Anschauen mit: Modellstart, Marke
      
```{r}
#Ladezeiten Mit Barreriekapazität
data %>%
  filter(Motorart == "Elektro") %>%
  group_by(Batteriekapazität..Netto..in.kWh) %>% 
  drop_na(Ladezeiten_Schuko.2.3kW) %>% 
  summarise(Ladezeiten_Schuko.2.3kW_mean = mean(Ladezeiten_Schuko.2.3kW)) %>% 
  ggplot(aes(x = Batteriekapazität..Netto..in.kWh, y = Ladezeiten_Schuko.2.3kW_mean)) +
  geom_point() +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(
    title = "Ladezeit nach Batterienkapazität von Elektromotoren",
    x = "Battarienkapazität",
    y = "Ladezeit (2.3kW) in Minuten"
  )
#mit hybrid etc
data %>%
  group_by(Batteriekapazität..Netto..in.kWh) %>% 
  drop_na(Ladezeiten_Schuko.2.3kW) %>% 
  summarise(Ladezeiten_Schuko.2.3kW_mean = mean(Ladezeiten_Schuko.2.3kW)) %>% 
  ggplot(aes(x = Batteriekapazität..Netto..in.kWh, y = Ladezeiten_Schuko.2.3kW_mean)) +
  geom_point() +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(
    title = "Ladezeit nach Batterienkapazität von allen Elektromotoren",
    x = "Battarienkapazität",
    y = "Ladezeit (2.3kW) in Minuten"
  )

#Durchschnittliche Ladezeit pro Jahr nach Baureihenstart
data %>% 
  filter(Motorart == "Elektro") %>%
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>%
  drop_na(Ladezeiten_Schuko.2.3kW) %>% 
  mutate(Ladezeiten_Schuko.2.3kW_mean = mean(Ladezeiten_Schuko.2.3kW)) %>% 
  ggplot(aes(x = Baureihenstart, y = Ladezeiten_Schuko.2.3kW_mean)) +
  geom_line() + 
  labs(
    title = "Entwicklung der durchschnittlichen Ladezeit von Elektromotoren (2.3 kW)",
    y = "Ladezwit des Autos in minuten"
  )

#Durchschnittliche Ladezeit nach Marke
data %>% 
  filter(Motorart == "Elektro") %>%
  drop_na(Ladezeiten_Schuko.2.3kW) %>% 
ggplot(aes(x = Marke, y = Ladezeiten_Schuko.2.3kW)) +
  geom_bar(position='dodge', stat='summary', fun='mean') +
  geom_text(aes(label=..count..), y=0, stat='count', colour="red", size=4) +
  labs(x = "Marke", y = "Durchschnittliche Ladezeit in minuten", title = "Durschnittliche Ladezeiten der E-Motoren nach Marke") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


#wie viele beobachtungen pro jahr
data %>% 
  filter(Motorart == "Elektro") %>%
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>%
  drop_na(Ladezeiten_Schuko.2.3kW) %>% 
ggplot(aes(x = Baureihenstart, y = Ladezeiten_Schuko.2.3kW)) +
  geom_bar(position='dodge', stat='summary', fun='mean') +
  geom_text(aes(label=..count..), y=0, stat='count', colour="red", size=4) +
  labs(x = "Marke", y = "Durchschnittliche Ladezeit in minuten", title = "Durschnittliche Ladezeiten der E-Motoren nach Marke") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Reichweite mit Batteriekapazität
data %>%
  filter(Motorart == "Elektro") %>%
  group_by(Batteriekapazität..Netto..in.kWh) %>% 
  drop_na(Reichweite.elektrisch.in.km) %>% 
  summarise(Reichweite.elektisch.in.km_mean = mean(Reichweite.elektrisch.in.km)) %>% 
  ggplot(aes(x = Batteriekapazität..Netto..in.kWh, y = Reichweite.elektisch.in.km_mean)) +
  geom_point() +
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(
    title = "Reichweite nach Batterienkapazität von Elektromotoren",
    x = "Battarienkapazität",
    y = "Recihweite in km"
  )

#Durchschnittliche Reichweite pro Jahr mit Baureihenstart
data %>% 
  filter(Motorart == "Elektro") %>%
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>%
  drop_na(Reichweite.elektrisch.in.km) %>% 
  mutate(Reichweite.elektisch.in.km_mean = mean(Reichweite.elektrisch.in.km)) %>% 
  ggplot(aes(x = Baureihenstart, y = Reichweite.elektisch.in.km_mean)) +
  geom_line() + 
  labs(
    title = "Entwicklung der durchschnittlichen Reichweite von Elektromotoren",
    y = "Reichweite des Autos in km"
  )
#Durchschnittliche Reichweite nach Marke
avg_Reichweite_E_Motor <- data %>%
  filter(Motorart == "Elektro") %>%
  group_by(Marke) %>%
  summarise(avg_Reichweite_E_Motor = mean(Reichweite.elektrisch.in.km, na.rm = TRUE))

avg_Reichweite_E_Motor <- drop_na(avg_Reichweite_E_Motor)

ggplot(avg_Reichweite_E_Motor, aes(x = Marke, y = avg_Reichweite_E_Motor)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(x = "Marke", y = "Durchschnittliche Reichweite", title = "Durschnittliche Reichweite der E-Motoren nach Marke") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

data %>% 
  filter(Motorart == "Elektro") %>%
  drop_na(Reichweite.elektrisch.in.km) %>% 
ggplot(aes(x = Marke, y = Reichweite.elektrisch.in.km)) +
  geom_bar(position='dodge', stat='summary', fun='mean') +
  geom_text(aes(label=..count..), y=0, stat='count', colour="red", size=4) +
  labs(x = "Marke", y = "Durchschnittliche Reichweite", title = "Durschnittliche Reichweite der E-Motoren nach Marke") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Durchschnittliche Reichweite pro Jahr mit Baureihenstart nach Marke ??
data %>% 
  filter(Motorart == "Elektro") %>%
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>%
  mutate(Anzahl.Jahr = n()) %>%
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Marke) %>%
  drop_na(Reichweite.elektrisch.in.km) %>% 
  mutate(Reichweite.elektisch.in.km_mean = mean(Reichweite.elektrisch.in.km)) %>% 
  ggplot(aes(x = Baureihenstart, y = Reichweite.elektisch.in.km_mean, color = Marke)) + 
  geom_line() + 
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(title = "Reichweite über Zeit der E-Motoren nach Marke", x = "Baureihenstart", y = "Reichweite", color = "Marke")

#für spezifsiche Marken: 
brands <- c("NIO", "MINI", "Opel", "BMW")
data %>%
  filter(Motorart == "Elektro", Marke %in% brands) %>%
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>%
  mutate(Anzahl.Jahr = n()) %>%
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Marke) %>%
  drop_na(Reichweite.elektrisch.in.km) %>% 
  mutate(Reichweite.elektisch.in.km_mean = mean(Reichweite.elektrisch.in.km)) %>% 
  ggplot(aes(x = Baureihenstart, y = Reichweite.elektisch.in.km_mean, color = Marke)) + 
  geom_point() + 
  geom_smooth(method = "loess", se = FALSE, color = "red") +
  labs(title = "Reichweite über Zeit der E-Motoren nach spezifischen Marken", x = "Baureihenstart", y = "Reichweite", color = "Marke")

#Durchschnittliche Reichweite pro Jahr mit Baureihenstart verglichen mit Verbrennern
data2 %>% 
  filter(Motorart %in% c("Elektro", "Verbrenner")) %>%
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year"), Motorart) %>%
  drop_na(Reichweite.Gesamt) %>% 
  mutate(Reichweite.Gesamt_mean = mean(Reichweite.Gesamt)) %>% 
  ggplot(aes(x = Baureihenstart, y = Reichweite.Gesamt_mean, color = Motorart)) +
  geom_line() + 
  labs(
    title = "Entwicklung der durchschnittlichen Reichweite von Elektromotoren vs Verbrenner",
    y = "Reichweite des Autos in km"
  )

#Batteriekapazität nach Baureihenstart
data %>% 
  filter(Motorart == "Elektro") %>%
  group_by(Baureihenstart = floor_date(Baureihenstart, unit = "year")) %>% # Vllt. ohne floor_date, aber dann geom_line mit geom_point ersetzen
  drop_na(Batteriekapazität..Netto..in.kWh) %>% 
  mutate(Batteriekapazität..Netto..in.kWh_mean = mean(Batteriekapazität..Netto..in.kWh)) %>% 
  ggplot(aes(x = Baureihenstart, y = Batteriekapazität..Netto..in.kWh_mean)) +
  geom_line() + 
  labs(
    title = "Entwicklung der durchschnittlichen Batteriekapazität in kWh pro Jahr von Elektromotoren",
    y = "Batteriekapazität in kWh"
  )

#Batteriekapazität nach Marke
data %>% 
  filter(Motorart == "Elektro") %>%
  drop_na(Batteriekapazität..Netto..in.kWh) %>% 
ggplot(aes(x = Marke, y = Batteriekapazität..Netto..in.kWh)) +
  geom_bar(position='dodge', stat='summary', fun='mean') +
  geom_text(aes(label=..count..), y=0, stat='count', colour="red", size=4) +
  labs(x = "Marke", y = "Durchschnittliche Batterienkapazität", title = "Durschnittliche Batterienkapazität der E-Motoren nach Marke") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Thema 9

Sicherheitsaspekte: Gibt die Anzahl an eingebauten Sicherheitsfeatures des Autos an. (Muss noch erstellt werden aus allen möglichen Spalten)
Anschauen mit: Modellstart, Marke, enthalten oder gegen Aufpreis 

```{r}

```

Thema 10

Anlass : welcher Mängel aufgetreten ist 
Zusammen mit Baureihenstart und Marke und Anzahl betroffener Fahrzeuge
```{r}
# Anzahl der mangelhaften Modelle pro Jahr und Marke
data %>% filter(Marke %in% eu_nicht_eu_marken) %>% 
  group_by(Marke, Baureihenstart) %>% 
  mutate(sum_Fehler = sum(Fehler_ja_nein)) %>%
  ggplot(aes(x = Baureihenstart, y = sum_Fehler, color = Marke)) + 
  geom_smooth(method = "loess", span = 0.4, se = FALSE, na.rm = TRUE) + 
  ylim(0,NA) +
  labs(title = "Anzahl der mangelhaften Modelle pro Jahr und Marke ", 
       x = "Zeit", 
       y = "Anzahl mangelhafter Modelle", 
       color = "Marke")


# Anzahl der mangelhaften Modelle pro Jahr und Antriebsart
data %>% group_by(Motorart, Baureihenstart) %>% 
  mutate(sum_Fehler = sum(Fehler_ja_nein)) %>%
  ggplot(aes(x = Baureihenstart, y = sum_Fehler, color = Motorart)) + 
  geom_smooth(method = "loess", span = 0.4, se = FALSE, na.rm = TRUE) + 
  ylim(0,NA) +
  labs(title = "Anzahl der mangelhaften Modelle pro Jahr und Marke ", 
       x = "Zeit", 
       y = "Anzahl mangelhafter Modelle", 
       color = "Antriebsart")
```
Erkenntnisse:

Höhepunkt der mangelhaften Modelle bei 2005 bei ca. 10 Stück dabei die deutschen Marken die meisten. 
Generell fallen die Anzahl der Mängel pro Jahr seit 2012.
Bei Hybrid und Elektor konstant ca. 2-3 Modelle pro Jahr bei Verbrenner ca. 10 bis max 17 im Jahr 2008 weil Warnung der USA wegen fälschung der Abgaswerte. 


----------------------------------------------
Variablen 


1.  Marke: Gibt den Hersteller des Autos an.

2.  Modellstart/Baureihenstart: Gibt an, wann das Modell angefangen wurde, produziert zu werden.

3.  CO2-Effizienzklasse: Gibt die CO2-Effizienzklasse des Autos an.

4.  Grundpreis: Gibt den Preis des Autos in Euro an.

5.  Motorart: Gibt die Motorart des Autos an. (Vllt. in allgeimeine Werte umwandeln, z.B. Verbrenner, Elektro, etc.)

6.  Leistung.maximal.in.PS..Systemleistung.: Gibt die maximale PS des Autos an.  # Vllt. in kW angeben, da das die offizielle Angabe ist?

7.  Hubraum..Verbrennungsmotor. / Hubraum: Gibt die Hubraumgröße des Motors des Autos in ccm an.

8.  Länge, Breite, Höhe -> Größe/Volumen: Gibt das Volumen des Autos in mm^3/m^3 an.

9.  Leergewicht..EU.: Gibt das Leergewicht des Autos in kg an.

10. Fahrzeugklasse: Gibt die Klasse des Autos an.

11. Höchstgeschwindigkeit: Gibt die Höchstgeschwindigkeit des Autos in km/h an.

12. Verbrauch.Gesamt..NEFZ.: Gibt den Gesamtverbrauch des Autos in l/100km oder kg/100km oder kWh/100km an.

13. CO2.Wert..NEFZ.: Gibt den CO2-Ausstoß des Autos in g/km an.

14. CO2.Ausstoß: Gibt den Vergleich zwischen dem CO2-Ausstoß nach Herstellerangabe und dem ADAC Ecotest an.

15. Verbrauch: Gibt den Vergleich zwischen dem Verbrauch nach Herstellerangabe und dem ADAC Ecotest an.

16. Ladezeiten: Gibt die Ladezeiten der Elektroautos bis zu 100% in Minuten für verschiedene Anschlüsse an.

17. Reichweite.WLTP..elektrisch.: Gibt die Reichweite für Elektroautos in km an.

18. Batteriekapazität..Netto..in.kWh: Gibt die Batteriekapazität der Autos in kWh an. 

19. Sicherheitsaspekte: Gibt die Anzahl an eingebauten Sicherheitsfeatures des Autos an. (Muss noch erstellt werden aus allen möglichen Spalten)

20. Anlass : welcher Mängel aufgetreten ist 